<!doctype html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Drag</title>
<style>
</style>
<h1>Drag</h1>
<pre>Tested:
- gestures/drag.js
</pre>
<div id="d1" style="width:100px;height:100px;border:5px solid green;background:#ddd">
	#D1, freeform drag
</div>

<script type="module">
  import GestureManager from "../src/gestureManager.js";
  import DragGesture from "../src/gestures/drag.js";
  import DragEffect from "../src/effects/dragEffect.js";
  import TestRunner from "./testFramework.js";
  import { LoggerEffect, createEvent, awaitTimeout, awaitSizeStopAnimating } from "./testUtils.js";

  async function installDragGesture() {
  	let el = document.querySelector("#d1");
    if (el.classList.contains("gestureInstalled"))
      return;
    else
      el.classList.add("gestureInstalled");
  	let gesture = new DragGesture(el, {effect: new DragEffect()});
  	GestureManager.addGesture(gesture);
  }

  async function dragFreely() {
    let el = document.querySelector("#d1");
    el.dispatchEvent(createEvent("pointerdown", el, { left: 5 }));
    el.dispatchEvent(createEvent("pointermove", document.body, { top: 200, left: 300}));
    el.dispatchEvent(createEvent("pointermove", document.body, { top: 200, left: 300}));
    await awaitTimeout(0);
    let loc = el.getBoundingClientRect();
    if (loc.x < 300 || loc.y < 200)
      throw `Drag did not move element ${loc.x} ${loc.y}`;
    el.dispatchEvent(createEvent("pointerup", el, { left: 0 }));
  }

  TestRunner.test(installDragGesture);
  TestRunner.test(dragFreely);

  installDragGesture();
</script>
